<!DOCTYPE html>
<html>
<head>
    <title>Kitchen Summary</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css?v=4">
</head>

<body>

<div class="container">

    <h1>Kitchen Summary</h1>

    <div class="top-bar">
        <input type="date" id="kitchenDate">
        <select id="kitchenMeal">
            <option>Lunch</option>
            <option>Dinner</option>
        </select>
        <button type="button" id="loadBtn">Load</button>
    </div>

    <div class="summary-grid">

        <div class="summary-card">
            <h3>Main</h3>
            <p>üêü Fish: <span id="fishCount" class="count-link" data-item="fish">0</span></p>
<p>üçó Roast Chicken: <span id="chickenCount" class="count-link" data-item="chicken">0</span></p>
<p>ü•ó Salad Plate: <span id="saladCount" class="count-link" data-item="salad">0</span></p>
        </div>

        <div class="summary-card">
            <h3>Vegetables</h3>
            <p>üü¢ Steamed Beans: 
    <span id="beansCount" class="count-link" data-item="beans">0</span>
</p>

<p>üü† Steamed Carrots: 
    <span id="carrotCount" class="count-link" data-item="carrots">0</span>
</p>        </div>

        <div class="summary-card">
            <h3>Dessert</h3>
           <p>Dessert 1: 
    <span id="dessert1Count" class="count-link" data-item="dessert1">0</span>
</p>

<p>Dessert 2: 
    <span id="dessert2Count" class="count-link" data-item="dessert2">0</span>
</p>

<p>Dessert 3: 
    <span id="dessert3Count" class="count-link" data-item="dessert3">0</span>
</p>        </div>

    </div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCTah0S3GhpsbK7hA8fQxKpmxmDjKSlTII",
    authDomain: "aged-care-meals.firebaseapp.com",
    projectId: "aged-care-meals",
    storageBucket: "aged-care-meals.firebasestorage.app",
    messagingSenderId: "548925762234",
    appId: "1:548925762234:web:20b446f31d62566cc7f083"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let roomLists = {};

  document.getElementById("loadBtn").addEventListener("click", async function () {

      const mealDate = document.getElementById("kitchenDate").value;
      const mealType = document.getElementById("kitchenMeal").value;

      if (!mealDate) {
          alert("Please select date");
          return;
      }

      const docId = mealDate + "_" + mealType;

      let fish = 0;
      let chicken = 0;
      let salad = 0;
      let beans = 0;
      let carrots = 0;
      let dessert1 = 0;
      let dessert2 = 0;
      let dessert3 = 0;

      roomLists = {
          fish: [],
          chicken: [],
          salad: [],
          beans: [],
          carrots: [],
          dessert1: [],
          dessert2: [],
          dessert3: []
      };

      const snapshot = await db.collection("orders")
          .doc(docId)
          .collection("rooms")
          .get();

      snapshot.forEach(doc => {

          const data = doc.data();
          const roomId = doc.id;

          if (data.main === "Fish") {
              fish++;
              roomLists.fish.push(roomId);
          }

          if (data.main === "Roast Chicken") {
              chicken++;
              roomLists.chicken.push(roomId);
          }

          if (data.main === "Salad Plate") {
              salad++;
              roomLists.salad.push(roomId);
          }

          if (data.vegetables?.includes("Steamed Beans")) {
              beans++;
              roomLists.beans.push(roomId);
          }

          if (data.vegetables?.includes("Steamed Carrots")) {
              carrots++;
              roomLists.carrots.push(roomId);
          }

          if (data.dessert === "Dessert 1") {
              dessert1++;
              roomLists.dessert1.push(roomId);
          }

          if (data.dessert === "Dessert 2") {
              dessert2++;
              roomLists.dessert2.push(roomId);
          }

          if (data.dessert === "Dessert 3") {
              dessert3++;
              roomLists.dessert3.push(roomId);
          }

      });

      document.getElementById("fishCount").innerText = fish;
      document.getElementById("chickenCount").innerText = chicken;
      document.getElementById("saladCount").innerText = salad;

      document.getElementById("beansCount").innerText = beans;
      document.getElementById("carrotCount").innerText = carrots;

      document.getElementById("dessert1Count").innerText = dessert1;
      document.getElementById("dessert2Count").innerText = dessert2;
      document.getElementById("dessert3Count").innerText = dessert3;

  });

  // CLICK HANDLER FOR SHOWING ROOMS
  document.addEventListener("click", function(e) {

      if (!e.target.dataset.item) return;

      const item = e.target.dataset.item;
      const rooms = roomLists[item] || [];

      document.getElementById("modalTitle").innerText =
          e.target.parentElement.innerText;

     document.getElementById("modalList").innerHTML =
    rooms.length === 0
        ? "No rooms"
        : rooms
            .sort((a,b)=>a-b)
            .map(r => "<div>" + r + "</div>")
            .join("");
      document.getElementById("roomModal").classList.remove("hidden");
  });

  document.getElementById("closeModal").addEventListener("click", function() {
      document.getElementById("roomModal").classList.add("hidden");
  });

</script>

<!-- Modal -->
<div id="roomModal" class="modal hidden">
    <div class="modal-content" id="modalContent">
        <h2 id="modalTitle"></h2>
     <div id="modalList" class="room-grid"></div>
        <button type="button" id="closeModal">Close</button>
    </div>
</div>

<script>
  const modal = document.getElementById("roomModal");
  const modalContent = document.getElementById("modalContent");

  // Close button
  document.getElementById("closeModal").addEventListener("click", function() {
      modal.classList.add("hidden");
  });

  // Click outside modal content closes it
  modal.addEventListener("click", function(e) {
      if (e.target === modal) {
          modal.classList.add("hidden");
      }
  });

  // Prevent clicks inside modal from closing it
  modalContent.addEventListener("click", function(e) {
      e.stopPropagation();
  });
</script>
</div>

</body>
</html>